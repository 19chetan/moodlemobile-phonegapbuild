webpackJsonp([13],{1742:function(n,e,l){"use strict";function t(n){return d._57(0,[(n()(),d._31(0,0,null,null,7,"ion-chip",[["class","addon-messages-date"],["color","light"]],null,null,null,null,null)),d._30(1,16384,null,0,H.a,[W.a,d.t,d.V],{color:[0,"color"]},null),(n()(),d._55(-1,null,["\n                    "])),(n()(),d._31(3,0,null,null,3,"ion-label",[],null,null,null,null,null)),d._30(4,16384,null,0,q.a,[W.a,d.t,d.V,[8,null],[8,null],[8,null],[8,null]],null,null),(n()(),d._55(5,null,["",""])),d._49(6,2),(n()(),d._55(-1,null,["\n                "]))],function(n,e){n(e,1,0,"light")},function(n,e){n(e,5,0,d._56(e,5,0,n(e,6,0,d._44(e.parent.parent,0),e.parent.context.$implicit.timecreated,"LL")))})}function s(n){return d._57(0,[(n()(),d._31(0,0,null,null,11,"ion-chip",[["class","addon-messages-unreadfrom"],["color","light"]],null,null,null,null,null)),d._30(1,16384,null,0,H.a,[W.a,d.t,d.V],{color:[0,"color"]},null),(n()(),d._55(-1,null,["\n                    "])),(n()(),d._31(3,0,null,null,4,"ion-label",[],null,null,null,null,null)),d._30(4,16384,null,0,q.a,[W.a,d.t,d.V,[8,null],[8,null],[8,null],[8,null]],null,null),(n()(),d._55(5,null,["",""])),d._48(6,{$a:0}),d._47(131072,G.a,[J.a,d.j]),(n()(),d._55(-1,null,["\n                    "])),(n()(),d._31(9,0,null,null,1,"ion-icon",[["name","arrow-round-down"],["role","img"]],[[2,"hide",null]],null,null,null,null)),d._30(10,147456,null,0,Y.a,[W.a,d.t,d.V],{name:[0,"name"]},null),(n()(),d._55(-1,null,["\n                "]))],function(n,e){n(e,1,0,"light");n(e,10,0,"arrow-round-down")},function(n,e){var l=e.component;n(e,5,0,d._56(e,5,0,d._44(e,7).transform("addon.messages.newmessages",n(e,6,0,l.title))));n(e,9,0,d._44(e,10)._hidden)})}function a(n){return d._57(0,[(n()(),d._31(0,0,null,null,3,"ion-note",[],null,null,null,null,null)),d._30(1,16384,null,0,Q.a,[W.a,d.t,d.V],null,null),(n()(),d._55(2,null,["\n                        ","\n                    "])),d._49(3,2)],null,function(n,e){n(e,2,0,d._56(e,2,0,n(e,3,0,d._44(e.parent.parent,0),e.parent.context.$implicit.timecreated,"dftimedate")))})}function o(n){return d._57(0,[(n()(),d._31(0,0,null,null,3,"ion-note",[],null,null,null,null,null)),d._30(1,16384,null,0,Q.a,[W.a,d.t,d.V],null,null),(n()(),d._31(2,0,null,null,1,"ion-icon",[["name","time"],["role","img"]],[[2,"hide",null]],null,null,null,null)),d._30(3,147456,null,0,Y.a,[W.a,d.t,d.V],{name:[0,"name"]},null)],function(n,e){n(e,3,0,"time")},function(n,e){n(e,2,0,d._44(e,3)._hidden)})}function i(n){return d._57(0,[(n()(),d._31(0,0,null,null,6,"button",[["class","addon-messages-delete-button"],["clear","true"],["icon-only",""],["ion-button",""]],[[24,"@coreSlideInOut",0],[1,"aria-label",0]],[[null,"click"]],function(n,e,l){var t=!0;if("click"===e){t=!1!==n.component.deleteMessage(n.parent.context.$implicit,n.parent.context.index)&&t}return t},Z.b,Z.a)),d._30(1,1097728,[[5,4]],0,nn.a,[[8,""],W.a,d.t,d.V],{clear:[0,"clear"]},null),d._47(131072,G.a,[J.a,d.j]),(n()(),d._55(-1,0,["\n                        "])),(n()(),d._31(4,0,null,0,1,"ion-icon",[["color","danger"],["name","trash"],["role","img"]],[[2,"hide",null]],null,null,null,null)),d._30(5,147456,null,0,Y.a,[W.a,d.t,d.V],{color:[0,"color"],name:[1,"name"]},null),(n()(),d._55(-1,0,["\n                    "]))],function(n,e){n(e,1,0,"true");n(e,5,0,"danger","trash")},function(n,e){n(e,0,0,"fromRight",d._56(e,0,1,d._44(e,2).transform("addon.messages.deletemessage")));n(e,4,0,d._44(e,5)._hidden)})}function u(n){return d._57(0,[(n()(),d._31(0,0,null,null,32,null,null,null,null,null,null,null)),(n()(),d._55(-1,null,["\n                "])),(n()(),d._26(16777216,null,null,1,null,t)),d._30(3,16384,null,0,en.k,[d._11,d._6],{ngIf:[0,"ngIf"]},null),(n()(),d._55(-1,null,["\n\n                "])),(n()(),d._26(16777216,null,null,1,null,s)),d._30(6,16384,null,0,en.k,[d._11,d._6],{ngIf:[0,"ngIf"]},null),(n()(),d._55(-1,null,["\n\n                "])),(n()(),d._31(8,0,null,null,23,"ion-item",[["class","addon-message item item-block"],["text-wrap",""]],[[2,"addon-message-mine",null],[24,"@coreSlideInOut",0]],[[null,"longPress"]],function(n,e,l){var t=!0;if("longPress"===e){t=!1!==n.component.copyMessage(n.context.$implicit.smallmessage)&&t}return t},ln.b,ln.a)),d._30(9,212992,null,0,tn.a,[d.t],null,{longPress:"longPress"}),d._30(10,1097728,null,3,sn.a,[an.a,W.a,d.t,d.V,[2,on.a]],null,null),d._52(335544320,4,{contentLabel:0}),d._52(603979776,5,{_buttons:1}),d._52(603979776,6,{_icons:1}),d._30(14,16384,null,0,un.a,[],null,null),(n()(),d._55(-1,2,["\n                    "])),(n()(),d._55(-1,2,["\n                    "])),(n()(),d._31(17,0,null,2,4,"p",[["class","addon-message-text"]],null,null,null,null,null)),(n()(),d._55(-1,null,["\n                        "])),(n()(),d._31(19,0,null,null,1,"core-format-text",[],null,[[null,"afterRender"]],function(n,e,l){var t=!0;if("afterRender"===e){t=!1!==(n.context.last&&n.component.scrollToBottom())&&t}return t},null,null)),d._30(20,540672,null,0,rn.a,[d.t,_.a,b.a,cn.a,J.a,dn.a,v.a,fn.a,M.a,gn.a,w.a,mn.a,[2,_n.a],[2,hn.a]],{text:[0,"text"]},{afterRender:"afterRender"}),(n()(),d._55(-1,null,["\n                    "])),(n()(),d._55(-1,2,["\n                    "])),(n()(),d._26(16777216,null,2,1,null,a)),d._30(24,16384,null,0,en.k,[d._11,d._6],{ngIf:[0,"ngIf"]},null),(n()(),d._55(-1,2,["\n                    "])),(n()(),d._26(16777216,null,2,1,null,o)),d._30(27,16384,null,0,en.k,[d._11,d._6],{ngIf:[0,"ngIf"]},null),(n()(),d._55(-1,2,["\n\n                    "])),(n()(),d._26(16777216,null,2,1,null,i)),d._30(30,16384,null,0,en.k,[d._11,d._6],{ngIf:[0,"ngIf"]},null),(n()(),d._55(-1,2,["\n                "])),(n()(),d._55(-1,null,["\n            "]))],function(n,e){var l=e.component;n(e,3,0,l.showDate(e.context.$implicit,l.messages[e.context.index-1]));n(e,6,0,e.context.$implicit.unreadFrom),n(e,9,0);n(e,20,0,e.context.$implicit.text);n(e,24,0,!e.context.$implicit.pending);n(e,27,0,e.context.$implicit.pending);n(e,30,0,!e.context.$implicit.sending&&l.showDelete)},function(n,e){var l=e.component;n(e,8,0,e.context.$implicit.useridfrom==l.currentUserId,e.context.$implicit.useridfrom==l.currentUserId?"":"fromLeft")})}function r(n){return d._57(0,[(n()(),d._31(0,0,null,null,2,"core-empty-box",[["icon","chatbubbles"]],null,null,null,pn.b,pn.a)),d._30(1,49152,null,0,yn.a,[],{message:[0,"message"],icon:[1,"icon"]},null),d._47(131072,G.a,[J.a,d.j])],function(n,e){n(e,1,0,d._56(e,1,0,d._44(e,2).transform("addon.messages.nomessages")),"chatbubbles")},null)}function c(n){return d._57(0,[d._47(0,bn.a,[M.a,J.a]),d._52(402653184,1,{content:0}),(n()(),d._31(2,0,null,null,35,"ion-header",[],null,null,null,null,null)),d._30(3,16384,null,0,vn.a,[W.a,d.t,d.V,[2,Mn.a]],null,null),(n()(),d._55(-1,null,["\n    "])),(n()(),d._31(5,0,null,null,11,"ion-navbar",[["class","toolbar"]],[[8,"hidden",0],[2,"statusbar-padding",null]],null,null,wn.b,wn.a)),d._30(6,49152,null,0,In.a,[Pn.a,[2,Mn.a],[2,_n.a],W.a,d.t,d.V],null,null),(n()(),d._55(-1,3,["\n        "])),(n()(),d._31(8,0,null,3,3,"ion-title",[],null,null,null,Dn.b,Dn.a)),d._30(9,49152,null,0,Cn.a,[W.a,d.t,d.V,[2,xn.a],[2,In.a]],null,null),(n()(),d._31(10,0,null,0,1,"core-format-text",[],null,null,null,null,null)),d._30(11,540672,null,0,rn.a,[d.t,_.a,b.a,cn.a,J.a,dn.a,v.a,fn.a,M.a,gn.a,w.a,mn.a,[2,_n.a],[2,hn.a]],{text:[0,"text"]},null),(n()(),d._55(-1,3,["\n        "])),(n()(),d._31(13,0,null,2,2,"ion-buttons",[["end",""]],null,null,null,null,null)),d._30(14,16384,null,1,kn.a,[W.a,d.t,d.V,[2,xn.a],[2,In.a]],null,null),d._52(603979776,2,{_buttons:1}),(n()(),d._55(-1,3,["\n    "])),(n()(),d._55(-1,null,["\n    "])),(n()(),d._31(18,0,null,null,18,"core-navbar-buttons",[["end",""]],null,null,null,Rn.b,Rn.a)),d._30(19,245760,null,1,Vn.a,[d.t,M.a,b.a],null,null),d._52(603979776,3,{buttons:1}),(n()(),d._55(-1,0,["\n        "])),(n()(),d._31(22,0,null,0,5,"button",[["clear","true"],["icon-only",""],["ion-button",""]],[[8,"hidden",0]],[[null,"click"]],function(n,e,l){var t=!0;if("click"===e){t=!1!==n.component.toggleDelete()&&t}return t},Z.b,Z.a)),d._30(23,1097728,[[3,4]],0,nn.a,[[8,""],W.a,d.t,d.V],{clear:[0,"clear"]},null),(n()(),d._55(-1,0,["\n            "])),(n()(),d._31(25,0,null,0,1,"ion-icon",[["name","trash"],["role","img"]],[[2,"hide",null]],null,null,null,null)),d._30(26,147456,null,0,Y.a,[W.a,d.t,d.V],{name:[0,"name"]},null),(n()(),d._55(-1,0,["\n        "])),(n()(),d._55(-1,0,["\n        "])),(n()(),d._31(29,0,null,0,6,"a",[["core-user-link",""]],[[8,"hidden",0],[1,"aria-label",0]],null,null,null,null)),d._30(30,81920,null,0,Sn.a,[d.t,[2,_n.a]],{userId:[0,"userId"]},null),d._47(131072,G.a,[J.a,d.j]),(n()(),d._55(-1,null,["\n            "])),(n()(),d._31(33,0,null,null,1,"img",[["class","button core-bar-button-image"],["core-external-content",""],["onError","this.src='assets/img/user-avatar.png'"]],[[8,"src",4]],null,null,null,null)),d._30(34,4210688,null,0,Ln.a,[d.t,M.a,gn.a,dn.a,_.a,b.a,fn.a,w.a],null,null),(n()(),d._55(-1,null,["\n        "])),(n()(),d._55(-1,0,["\n    "])),(n()(),d._55(-1,null,["\n"])),(n()(),d._55(-1,null,["\n"])),(n()(),d._31(39,0,null,null,24,"ion-content",[],[[2,"statusbar-padding",null],[2,"has-refresher",null]],null,null,Un.b,Un.a)),d._30(40,4374528,[[1,4]],0,hn.a,[W.a,dn.a,Fn.a,d.t,d.V,Pn.a,En.a,d.M,[2,Mn.a],[2,_n.a]],null,null),(n()(),d._55(-1,1,["\n    "])),(n()(),d._31(42,0,null,1,20,"core-loading",[],null,null,null,jn.b,jn.a)),d._30(43,638976,null,0,On.a,[J.a,d.t],{hideUntil:[0,"hideUntil"]},null),(n()(),d._55(-1,0,["\n        "])),(n()(),d._55(-1,0,["\n        "])),(n()(),d._31(46,0,null,0,5,"ion-infinite-scroll",[["position","top"]],null,[[null,"ionInfinite"]],function(n,e,l){var t=!0;if("ionInfinite"===e){t=!1!==n.component.loadPrevious(l)&&t}return t},null,null)),d._30(47,1196032,null,0,Tn.a,[hn.a,d.M,d.t,Fn.a],{enabled:[0,"enabled"],position:[1,"position"]},{ionInfinite:"ionInfinite"}),(n()(),d._55(-1,null,["\n           "])),(n()(),d._31(49,0,null,null,1,"ion-infinite-scroll-content",[],[[1,"state",0]],null,null,Xn.b,Xn.a)),d._30(50,114688,null,0,zn.a,[Tn.a,W.a],null,null),(n()(),d._55(-1,null,["\n        "])),(n()(),d._55(-1,0,["\n        "])),(n()(),d._31(53,0,null,0,5,"ion-list",[["class","addon-messages-discussion-container"]],[[1,"aria-live",0]],null,null,null,null)),d._30(54,16384,null,0,An.a,[W.a,d.t,d.V,dn.a,Bn.l,Fn.a],null,null),(n()(),d._55(-1,null,["\n            "])),(n()(),d._26(16777216,null,null,1,null,u)),d._30(57,802816,null,0,en.j,[d._11,d._6,d.E],{ngForOf:[0,"ngForOf"]},null),(n()(),d._55(-1,null,["\n        "])),(n()(),d._55(-1,0,["\n        "])),(n()(),d._26(16777216,null,0,1,null,r)),d._30(61,16384,null,0,en.k,[d._11,d._6],{ngIf:[0,"ngIf"]},null),(n()(),d._55(-1,0,["\n    "])),(n()(),d._55(-1,1,["\n"])),(n()(),d._55(-1,null,["\n"])),(n()(),d._31(65,0,null,null,10,"ion-footer",[["class","footer-adjustable"],["color","light"]],null,null,null,null,null)),d._30(66,16384,null,0,$n.a,[W.a,d.t,d.V,[2,Mn.a]],{color:[0,"color"]},null),(n()(),d._55(-1,null,["\n    "])),(n()(),d._31(68,0,null,null,6,"ion-toolbar",[["class","toolbar"],["color","light"],["position","bottom"]],[[2,"statusbar-padding",null]],null,null,Kn.b,Kn.a)),d._30(69,49152,null,0,xn.a,[W.a,d.t,d.V],{color:[0,"color"]},null),(n()(),d._55(-1,3,["\n        "])),(n()(),d._31(71,0,null,3,2,"core-send-message-form",[],null,[[null,"onSubmit"],[null,"onResize"]],function(n,e,l){var t=!0,s=n.component;if("onSubmit"===e){t=!1!==s.sendMessage(l)&&t}if("onResize"===e){t=!1!==s.resizeContent()&&t}return t},Nn.b,Nn.a)),d._30(72,114688,null,0,Hn.a,[v.a,cn.a],{placeholder:[0,"placeholder"],showKeyboard:[1,"showKeyboard"]},{onSubmit:"onSubmit",onResize:"onResize"}),d._47(131072,G.a,[J.a,d.j]),(n()(),d._55(-1,3,["\n    "])),(n()(),d._55(-1,null,["\n"])),(n()(),d._55(-1,null,["\n"]))],function(n,e){var l=e.component;n(e,11,0,l.title),n(e,19,0);n(e,23,0,"true");n(e,26,0,"trash");n(e,30,0,l.userId);n(e,43,0,l.loaded);n(e,47,0,l.canLoadMore,"top"),n(e,50,0);n(e,57,0,l.messages);n(e,61,0,!l.messages||l.messages.length<=0);n(e,66,0,"light");n(e,69,0,"light");n(e,72,0,d._56(e,72,0,d._44(e,73).transform("addon.messages.newmessage")),l.showKeyboard)},function(n,e){var l=e.component;n(e,5,0,d._44(e,6)._hidden,d._44(e,6)._sbPadding);n(e,22,0,!l.canDelete);n(e,25,0,d._44(e,26)._hidden);n(e,29,0,!l.showProfileLink,d._56(e,29,1,d._44(e,31).transform("core.user.viewprofile")));n(e,33,0,l.profileLink);n(e,39,0,d._44(e,40).statusbarPadding,d._44(e,40)._hasRefresher);n(e,49,0,d._44(e,50).inf.state);n(e,53,0,l.polite);n(e,68,0,d._44(e,69)._sbPadding)})}Object.defineProperty(e,"__esModule",{value:!0});var d=l(0),f=l(9),g=l(7),m=l(21),_=l(1),h=l(152),p=l(420),y=l(44),b=l(6),v=l(4),M=l(2),w=l(12),I=l(1323),P=l(178),D=l(11),C=this&&this.__decorate||function(n,e,l,t){var s,a=arguments.length,o=a<3?e:null===t?t=Object.getOwnPropertyDescriptor(e,l):t;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(n,e,l,t);else for(var i=n.length-1;i>=0;i--)(s=n[i])&&(o=(a<3?s(o):a>3?s(e,l,o):s(e,l))||o);return a>3&&o&&Object.defineProperty(e,l,o),o},x=this&&this.__metadata||function(n,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,e)},k=function(){function n(n,e,l,t,s,a,o,i,u,r,c,d){var f=this;this.eventsProvider=n,this.userProvider=t,this.navCtrl=s,this.messagesSync=a,this.domUtils=o,this.messagesProvider=i,this.utils=r,this.appProvider=c,this.translate=d,this.unreadMessageFrom=0,this.messagesBeingSent=0,this.pagesLoaded=1,this.lastMessage={text:"",timecreated:0},this.keepMessageMap={},this.oldContentHeight=0,this.loaded=!1,this.showKeyboard=!1,this.canLoadMore=!1,this.messages=[],this.showDelete=!1,this.canDelete=!1,this.scrollBottom=!0,this.viewDestroyed=!1,this.siteId=e.getCurrentSiteId(),this.currentUserId=e.getCurrentSiteUserId(),this.logger=u.getInstance("AddonMessagesDiscussionPage"),this.userId=l.get("userId"),this.showKeyboard=l.get("showKeyboard"),this.syncObserver=n.on(p.a.AUTO_SYNCED,function(n){n.userId==f.userId&&(f.fetchData(),n.warnings&&n.warnings[0]&&f.domUtils.showErrorModal(n.warnings[0]))},this.siteId)}return n.prototype.addMessage=function(n,e){void 0===e&&(e=!0),n.hash=P.Md5.hashAsciiStr(n.smallmessage)+"#"+n.timecreated+"#"+n.useridfrom,void 0===this.keepMessageMap[n.hash]&&this.messages.push(n),this.keepMessageMap[n.hash]=e},n.prototype.removeMessage=function(n){if(this.keepMessageMap[n])this.keepMessageMap[n]=!1;else{delete this.keepMessageMap[n];var e=this.messages.findIndex(function(e){return e.hash==n});e>0&&this.messages.splice(e,1)}},n.prototype.ionViewDidLoad=function(){var n=this,e=this.navCtrl.getPrevious()&&this.navCtrl.getPrevious().component.name;this.showProfileLink=!e||"CoreUserProfilePage"!==e,this.userProvider.getProfile(this.userId,void 0,!0).then(function(e){n.title||(n.title=e.fullname),n.profileLink=e.profileimageurl}),this.messagesSync.syncDiscussion(this.userId).catch(function(){}).then(function(e){return e&&e[0]&&n.domUtils.showErrorModal(e[0]),n.fetchData().then(function(){!n.title&&n.messages.length&&(n.title=n.messages[0].useridto!=n.currentUserId?n.messages[0].usertofullname||"":n.messages[0].userfromfullname||"")}).catch(function(e){n.domUtils.showErrorModalDefault(e,"addon.messages.errorwhileretrievingmessages",!0)}).finally(function(){n.checkCanDelete(),n.resizeContent(),n.loaded=!0})})},n.prototype.ionViewDidEnter=function(){this.setPolling()},n.prototype.ionViewWillLeave=function(){this.unsetPolling()},n.prototype.fetchData=function(){var n=this;return this.logger.debug("Polling new messages for discussion with user '"+this.userId+"'"),this.messagesBeingSent>0?Promise.reject(null):this.fetching?Promise.reject(null):(this.fetching=!0,this.messagesSync.waitForSync(this.userId).then(function(){return n.messagesProvider.invalidateDiscussionCache(n.userId).catch(function(){})}).then(function(){return n.getDiscussion(n.pagesLoaded)}).then(function(e){if(n.viewDestroyed)return Promise.resolve();if(n.scrollBottom=n.content.scrollHeight-n.content.scrollTop===n.content.contentHeight,n.messagesBeingSent>0)return Promise.reject(null);e.forEach(function(e){n.addMessage(e)});for(var l in n.keepMessageMap)n.removeMessage(l);n.messagesProvider.sortMessages(n.messages),n.notifyNewMessage(),n.markMessagesAsRead()}).finally(function(){n.fetching=!1}))},n.prototype.getDiscussion=function(n,e,l,t,s){var a=this;void 0===e&&(e=0),void 0===l&&(l=0),void 0===t&&(t=0),void 0===s&&(s=0);return this.messagesProvider.getDiscussion(this.userId,e>0||l>0||t>0||s>0,e,l,t,s).then(function(o){return--n>0&&o.canLoadMore?(o.messages.forEach(function(n){n.pending||(n.useridfrom==a.userId?n.read?l++:e++:n.read?s++:t++)}),a.getDiscussion(n,e,l,t,s).then(function(n){return o.messages.concat(n)})):(a.canLoadMore=o.canLoadMore,o.messages)})},n.prototype.markMessagesAsRead=function(){var n=this,e=!1,l=[];if(this.messagesProvider.isMarkAllMessagesReadEnabled()){var t=!1;for(var s in this.messages){var a=this.messages[s];if(a.useridfrom!=this.currentUserId&&0==a.read){t=!0;break}}t&&(this.setUnreadLabelPosition(),l.push(this.messagesProvider.markAllMessagesRead(this.userId).then(function(){e=!0,n.messages.forEach(function(n){n.read=1})})))}else this.setUnreadLabelPosition(),this.messages.forEach(function(t){t.useridfrom!=n.currentUserId&&0==t.read&&l.push(n.messagesProvider.markMessageRead(t.id).then(function(){e=!0,t.read=1}))});Promise.all(l).finally(function(){e&&n.eventsProvider.trigger(h.a.READ_CHANGED_EVENT,{userId:n.userId},n.siteId)})},n.prototype.notifyNewMessage=function(){var n=this.messages[this.messages.length-1],e=!1;if(n?n.text===this.lastMessage.text&&n.timecreated===this.lastMessage.timecreated||(this.lastMessage={text:n.text,timecreated:n.timecreated},e=!0):(this.lastMessage={text:"",timecreated:0},e=!0),e){this.eventsProvider.trigger(h.a.NEW_MESSAGE_EVENT,{userId:this.userId,message:this.lastMessage.text,timecreated:this.lastMessage.timecreated},this.siteId);this.canDelete!=(n&&n.id&&1==this.messages.length||this.messages.length>1)&&this.checkCanDelete()}},n.prototype.setUnreadLabelPosition=function(){if(0==this.unreadMessageFrom){var n=!1;for(var e in this.messages){var l=this.messages[e];if(l.useridfrom!=this.currentUserId){if(l.unreadFrom=0==l.read&&n,l.unreadFrom){this.unreadMessageFrom=parseInt(l.id,10);break}n=0!=l.read}}0==this.unreadMessageFrom&&(this.unreadMessageFrom=-1)}},n.prototype.checkCanDelete=function(){var n=this.messages[0];this.canDelete=n&&!n.sending},n.prototype.hideUnreadLabel=function(){if(this.unreadMessageFrom>0){for(var n in this.messages){var e=this.messages[n];if(e.id==this.unreadMessageFrom){e.unreadFrom=!1;break}}this.unreadMessageFrom=-1}},n.prototype.waitForFetch=function(){var n=this;if(!this.fetching)return Promise.resolve();var e=this.utils.promiseDefer();return setTimeout(function(){return n.waitForFetch().finally(function(){e.resolve()})},400),e.promise},n.prototype.setPolling=function(){var n=this;this.polling||(this.polling=setInterval(function(){n.fetchData().catch(function(){})},h.a.POLL_INTERVAL))},n.prototype.unsetPolling=function(){this.polling&&(this.logger.debug("Cancelling polling for conversation with user '"+this.userId+"'"),clearInterval(this.polling),this.polling=void 0)},n.prototype.copyMessage=function(n){this.utils.copyToClipboard(n)},n.prototype.deleteMessage=function(n,e){var l=this;this.domUtils.showConfirm(this.translate.instant(n.pending?"core.areyousure":"addon.messages.deletemessageconfirmation")).then(function(){var t=l.domUtils.showModalLoading("core.deleting",!0);return l.messagesProvider.deleteMessage(n).then(function(){l.messages.splice(e,1),l.removeMessage(n.hash),l.notifyNewMessage(),l.fetchData()}).finally(function(){t.dismiss()})}).catch(function(n){l.domUtils.showErrorModalDefault(n,"addon.messages.errordeletemessage",!0)})},n.prototype.loadPrevious=function(n){var e=this;return this.waitForFetch().finally(function(){e.pagesLoaded++,e.fetchData().catch(function(n){e.pagesLoaded--,e.domUtils.showErrorModalDefault(n,"addon.messages.errorwhileretrievingmessages",!0)}).finally(function(){n.complete()})})},n.prototype.resizeContent=function(){var n=this,e=this.content.getContentDimensions().scrollTop;this.content.resize(),setTimeout(function(){!n.viewDestroyed&&n.content&&n.content.contentHeight!=n.oldContentHeight&&(e||(e=n.content.getContentDimensions().scrollTop),e+=n.oldContentHeight-n.content.contentHeight,n.oldContentHeight=n.content.contentHeight,n.content.scrollTo(0,e,0))})},n.prototype.scrollToBottom=function(){var n=this;this.scrollBottom&&(setTimeout(function(){n.viewDestroyed||n.content.scrollToBottom(0)}),this.scrollBottom=!1)},n.prototype.sendMessage=function(n){var e,l=this;this.hideUnreadLabel(),this.showDelete=!1,this.scrollBottom=!0,e={pending:!0,sending:!0,useridfrom:this.currentUserId,smallmessage:n,text:n,timecreated:(new Date).getTime()},this.addMessage(e,!1),this.messagesBeingSent++,this.waitForFetch().finally(function(){l.messagesProvider.sendMessage(l.userId,n).then(function(n){l.messagesBeingSent--,(n.sent?l.fetchData():Promise.reject(null)).catch(function(){e.sending=!1,n.sent?e.pending=!1:n.message&&(e.timecreated=n.message.timecreated),l.notifyNewMessage()})}).catch(function(n){l.messagesBeingSent--,l.appProvider.closeKeyboard(),l.domUtils.showErrorModalDefault(n,"addon.messages.messagenotsent",!0),l.removeMessage(e.hash)})})},n.prototype.showDate=function(n,e){return!e||!n.pending&&!D(n.timecreated).isSame(e.timecreated,"day")},n.prototype.toggleDelete=function(){this.showDelete=!this.showDelete},n.prototype.ngOnDestroy=function(){this.unsetPolling(),this.syncObserver&&this.syncObserver.off(),this.viewDestroyed=!0},C([Object(d._9)(f.f),x("design:type",f.f)],n.prototype,"content",void 0),n=C([Object(d.m)({selector:"page-addon-messages-discussion",templateUrl:"discussion.html",animations:[I.b]}),x("design:paramtypes",[m.a,_.a,f.r,y.a,f.q,p.a,b.a,h.a,M.a,v.a,w.a,g.c])],n)}(),R=l(31),V=l(30),S=l(111),L=this&&this.__decorate||function(n,e,l,t){var s,a=arguments.length,o=a<3?e:null===t?t=Object.getOwnPropertyDescriptor(e,l):t;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(n,e,l,t);else for(var i=n.length-1;i>=0;i--)(s=n[i])&&(o=(a<3?s(o):a>3?s(e,l,o):s(e,l))||o);return a>3&&o&&Object.defineProperty(e,l,o),o},U=function(){function n(){}return n=L([Object(d.I)({declarations:[k],imports:[R.a,V.a,S.a,f.l.forChild(k),g.b.forChild()]})],n)}(),F=l(1243),E=l(1244),j=l(1245),O=l(1246),T=l(1247),X=l(1248),z=l(1249),A=l(1250),B=l(1251),$=l(1254),K=l(1255),N=l(1256),H=l(657),W=l(3),q=l(61),G=l(28),J=l(15),Y=l(38),Q=l(231),Z=l(43),nn=l(37),en=l(8),ln=l(33),tn=l(1320),sn=l(19),an=l(18),on=l(29),un=l(32),rn=l(39),cn=l(10),dn=l(13),fn=l(23),gn=l(16),mn=l(22),_n=l(20),hn=l(24),pn=l(151),yn=l(129),bn=l(316),vn=l(402),Mn=l(34),wn=l(1252),In=l(182),Pn=l(27),Dn=l(1253),Cn=l(315),xn=l(227),kn=l(403),Rn=l(80),Vn=l(72),Sn=l(258),Ln=l(166),Un=l(183),Fn=l(25),En=l(93),jn=l(57),On=l(55),Tn=l(212),Xn=l(413),zn=l(235),An=l(75),Bn=l(35),$n=l(635),Kn=l(1846),Nn=l(1853),Hn=l(1268),Wn=l(54),qn=d._29({encapsulation:2,styles:[],data:{animation:[{type:7,name:"coreSlideInOut",definitions:[{type:1,expr:"void => fromLeft",animation:[{type:6,styles:{transform:"translateX(0)",opacity:1},offset:null},{type:4,styles:{type:5,steps:[{type:6,styles:{opacity:0,transform:"translateX(-100%)",offset:0},offset:null},{type:6,styles:{opacity:1,transform:"translateX(5%)",offset:.7},offset:null},{type:6,styles:{opacity:1,transform:"translateX(0)",offset:1},offset:null}]},timings:300}],options:null},{type:1,expr:"fromLeft => void",animation:[{type:6,styles:{transform:"translateX(-100%)",opacity:0},offset:null},{type:4,styles:{type:5,steps:[{type:6,styles:{opacity:1,transform:"translateX(0)",offset:0},offset:null},{type:6,styles:{opacity:1,transform:"translateX(5%)",offset:.3},offset:null},{type:6,styles:{opacity:0,transform:"translateX(-100%)",offset:1},offset:null}]},timings:300}],options:null},{type:1,expr:"void => fromRight",animation:[{type:6,styles:{transform:"translateX(0)",opacity:1},offset:null},{type:4,styles:{type:5,steps:[{type:6,styles:{opacity:0,transform:"translateX(100%)",offset:0},offset:null},{type:6,styles:{opacity:1,transform:"translateX(-5%)",offset:.7},offset:null},{type:6,styles:{opacity:1,transform:"translateX(0)",offset:1},offset:null}]},timings:300}],options:null},{type:1,expr:"fromRight => void",animation:[{type:6,styles:{transform:"translateX(-100%)",opacity:0},offset:null},{type:4,styles:{type:5,steps:[{type:6,styles:{opacity:1,transform:"translateX(0)",offset:0},offset:null},{type:6,styles:{opacity:1,transform:"translateX(-5%)",offset:.3},offset:null},{type:6,styles:{opacity:0,transform:"translateX(100%)",offset:1},offset:null}]},timings:300}],options:null}],options:{}}]}}),Gn=d._27("page-addon-messages-discussion",k,function(n){return d._57(0,[(n()(),d._31(0,0,null,null,1,"page-addon-messages-discussion",[],null,null,null,c,qn)),d._30(1,180224,null,0,k,[m.a,_.a,Wn.a,y.a,_n.a,p.a,b.a,h.a,M.a,v.a,w.a,J.a],null,null)],null,null)},{},{},[]),Jn=l(17),Yn=l(311),Qn=l(312),Zn=l(314),ne=l(313),ee=l(401),le=l(615),te=l(228);l.d(e,"AddonMessagesDiscussionPageModuleNgFactory",function(){return se});var se=d._28(U,[],function(n){return d._40([d._41(512,d.o,d._21,[[8,[F.a,E.a,j.a,O.a,T.a,X.a,z.a,A.a,B.a,$.a,K.a,N.a,Gn]],[3,d.o],d.K]),d._41(4608,en.m,en.l,[d.G,[2,en.v]]),d._41(4608,Jn.x,Jn.x,[]),d._41(4608,Jn.d,Jn.d,[]),d._41(4608,Yn.b,Yn.a,[]),d._41(4608,Qn.a,Qn.b,[]),d._41(4608,Zn.b,Zn.a,[]),d._41(4608,ne.b,ne.a,[]),d._41(4608,J.a,J.a,[ee.a,Yn.b,Qn.a,Zn.b,ne.b,J.b,J.c]),d._41(512,en.b,en.b,[]),d._41(512,Jn.v,Jn.v,[]),d._41(512,Jn.i,Jn.i,[]),d._41(512,Jn.s,Jn.s,[]),d._41(512,le.a,le.a,[]),d._41(512,g.b,g.b,[]),d._41(512,V.a,V.a,[]),d._41(512,S.a,S.a,[]),d._41(512,R.a,R.a,[]),d._41(512,le.b,le.b,[]),d._41(512,U,U,[]),d._41(256,J.c,void 0,[]),d._41(256,J.b,void 0,[]),d._41(256,te.a,k,[])])})},1846:function(n,e,l){"use strict";function t(n){return s._57(2,[(n()(),s._31(0,0,null,null,1,"div",[["class","toolbar-background"]],null,null,null,null,null)),s._30(1,278528,null,0,a.i,[s.E,s.F,s.t,s.W],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),s._43(null,0),s._43(null,1),s._43(null,2),(n()(),s._31(5,0,null,null,2,"div",[["class","toolbar-content"]],null,null,null,null,null)),s._30(6,278528,null,0,a.i,[s.E,s.F,s.t,s.W],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),s._43(null,3)],function(n,e){var l=e.component;n(e,1,0,"toolbar-background","toolbar-background-"+l._mode);n(e,6,0,"toolbar-content","toolbar-content-"+l._mode)},null)}l.d(e,"a",function(){return u}),e.b=t;var s=l(0),a=l(8),o=l(227),i=l(3),u=s._29({encapsulation:2,styles:[],data:{}});s._27("ion-toolbar",o.a,function(n){return s._57(0,[(n()(),s._31(0,0,null,null,1,"ion-toolbar",[["class","toolbar"]],[[2,"statusbar-padding",null]],null,null,t,u)),s._30(1,49152,null,0,o.a,[i.a,s.t,s.V],null,null)],null,function(n,e){n(e,0,0,s._44(e,1)._sbPadding)})},{color:"color",mode:"mode"},{},["[menuToggle],ion-buttons[left]","ion-buttons[start]","ion-buttons[end],ion-buttons[right]","*"])},1853:function(n,e,l){"use strict";function t(n){return s._57(0,[(n()(),s._31(0,0,null,null,27,"form",[["novalidate",""]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngSubmit"],[null,"submit"],[null,"reset"]],function(n,e,l){var t=!0,a=n.component;if("submit"===e){t=!1!==s._44(n,2).onSubmit(l)&&t}if("reset"===e){t=!1!==s._44(n,2).onReset()&&t}if("ngSubmit"===e){t=!1!==a.submitForm(l)&&t}return t},null,null)),s._30(1,16384,null,0,a.w,[],null,null),s._30(2,4210688,null,0,a.p,[[8,null],[8,null]],null,{ngSubmit:"ngSubmit"}),s._50(2048,null,a.b,null,[a.p]),s._30(4,16384,null,0,a.o,[a.b],null,null),(n()(),s._55(-1,null,["\n    "])),(n()(),s._31(6,0,null,null,7,"textarea",[["class","core-send-message-input"],["core-auto-rows",""],["name","message"],["rows","1"]],[[8,"placeholder",0],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"onResize"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"],[null,"change"]],function(n,e,l){var t=!0,a=n.component;if("input"===e){t=!1!==s._44(n,7)._handleInput(l.target.value)&&t}if("blur"===e){t=!1!==s._44(n,7).onTouched()&&t}if("compositionstart"===e){t=!1!==s._44(n,7)._compositionStart()&&t}if("compositionend"===e){t=!1!==s._44(n,7)._compositionEnd(l.target.value)&&t}if("input"===e){t=!1!==s._44(n,13).onInput()&&t}if("change"===e){t=!1!==s._44(n,13).onChange()&&t}if("ngModelChange"===e){t=!1!==(a.message=l)&&t}if("onResize"===e){t=!1!==a.textareaResized()&&t}return t},null,null)),s._30(7,16384,null,0,a.c,[s.W,s.t,[2,a.a]],null,null),s._50(1024,null,a.l,function(n){return[n]},[a.c]),s._30(9,671744,null,0,a.q,[[2,a.b],[8,null],[8,null],[2,a.l]],{name:[0,"name"],model:[1,"model"]},{update:"ngModelChange"}),s._50(2048,null,a.m,null,[a.q]),s._30(11,16384,null,0,a.n,[a.m],null,null),s._30(12,81920,null,0,o.a,[s.t,i.a,u.a,[2,r.a]],{coreAutoFocus:[0,"coreAutoFocus"]},null),s._30(13,16384,null,0,c.a,[s.t],null,{onResize:"onResize"}),(n()(),s._55(-1,null,["\n    "])),(n()(),s._31(15,0,null,null,11,"ion-buttons",[["end",""]],null,null,null,null,null)),s._30(16,16384,null,1,d.a,[f.a,s.t,s.V,[2,g.a],[2,m.a]],null,null),s._52(603979776,1,{_buttons:1}),(n()(),s._55(-1,null,["\n        "])),(n()(),s._31(19,0,null,null,6,"button",[["clear","true"],["icon-only",""],["ion-button",""],["type","submit"]],[[8,"disabled",0],[1,"aria-label",0]],null,null,_.b,_.a)),s._30(20,1097728,[[1,4]],0,h.a,[[8,""],f.a,s.t,s.V],{clear:[0,"clear"]},null),s._47(131072,p.a,[y.a,s.j]),(n()(),s._55(-1,0,["\n            "])),(n()(),s._31(23,0,null,0,1,"ion-icon",[["color","dark"],["name","send"],["role","img"]],[[2,"hide",null]],null,null,null,null)),s._30(24,147456,null,0,b.a,[f.a,s.t,s.V],{color:[0,"color"],name:[1,"name"]},null),(n()(),s._55(-1,0,["\n        "])),(n()(),s._55(-1,null,["\n    "])),(n()(),s._55(-1,null,["\n"])),(n()(),s._55(-1,null,["\n"]))],function(n,e){var l=e.component;n(e,9,0,"message",l.message);n(e,12,0,l.showKeyboard);n(e,20,0,"true");n(e,24,0,"dark","send")},function(n,e){var l=e.component;n(e,0,0,s._44(e,4).ngClassUntouched,s._44(e,4).ngClassTouched,s._44(e,4).ngClassPristine,s._44(e,4).ngClassDirty,s._44(e,4).ngClassValid,s._44(e,4).ngClassInvalid,s._44(e,4).ngClassPending);n(e,6,0,l.placeholder,s._44(e,11).ngClassUntouched,s._44(e,11).ngClassTouched,s._44(e,11).ngClassPristine,s._44(e,11).ngClassDirty,s._44(e,11).ngClassValid,s._44(e,11).ngClassInvalid,s._44(e,11).ngClassPending);n(e,19,0,!l.message,s._56(e,19,1,s._44(e,21).transform("core.send")));n(e,23,0,s._44(e,24)._hidden)})}l.d(e,"a",function(){return w}),e.b=t;var s=l(0),a=l(17),o=l(319),i=l(6),u=l(4),r=l(20),c=l(1284),d=l(403),f=l(3),g=l(227),m=l(182),_=l(43),h=l(37),p=l(28),y=l(15),b=l(38),v=l(1268),M=l(10),w=s._29({encapsulation:2,styles:[],data:{}});s._27("core-send-message-form",v.a,function(n){return s._57(0,[(n()(),s._31(0,0,null,null,1,"core-send-message-form",[],null,null,null,t,w)),s._30(1,114688,null,0,v.a,[u.a,M.a],null,null)],function(n,e){n(e,1,0)},null)},{message:"message",placeholder:"placeholder",showKeyboard:"showKeyboard"},{onSubmit:"onSubmit",onResize:"onResize"},[])}});