webpackJsonp([107],{1732:function(n,t,e){"use strict";function l(n){return c._57(0,[(n()(),c._31(0,0,null,null,6,"button",[["icon-only",""],["ion-button",""]],[[1,"aria-label",0]],[[null,"click"]],function(n,t,e){var l=!0;if("click"===t){l=!1!==n.component.openCourseFilter(e)&&l}return l},Y.b,Y.a)),c._30(1,1097728,[[3,4]],0,q.a,[[8,""],z.a,c.t,c.V],null,null),c._47(131072,J.a,[K.a,c.j]),(n()(),c._55(-1,0,["\n                "])),(n()(),c._31(4,0,null,0,1,"ion-icon",[["name","funnel"],["role","img"]],[[2,"hide",null]],null,null,null,null)),c._30(5,147456,null,0,W.a,[z.a,c.t,c.V],{name:[0,"name"]},null),(n()(),c._55(-1,0,["\n            "]))],function(n,t){n(t,5,0,"funnel")},function(n,t){n(t,0,0,c._56(t,0,0,c._44(t,2).transform("core.courses.filter")));n(t,4,0,c._44(t,5)._hidden)})}function i(n){return c._57(0,[(n()(),c._31(0,0,null,null,3,"core-empty-box",[["icon","calendar"]],null,null,null,B.b,B.a)),c._30(1,49152,null,0,Q.a,[],{message:[0,"message"],icon:[1,"icon"]},null),c._47(131072,J.a,[K.a,c.j]),(n()(),c._55(-1,0,["\n            "]))],function(n,t){n(t,1,0,c._56(t,1,0,c._44(t,2).transform("addon.calendar.noevents")),"calendar")},null)}function a(n){return c._57(0,[(n()(),c._31(0,0,null,null,0,"img",[["class","core-module-icon"],["item-start",""]],[[8,"src",4]],null,null,null,null))],null,function(n,t){n(t,0,0,c._34(1,"",t.parent.context.$implicit.moduleIcon,""))})}function o(n){return c._57(0,[(n()(),c._31(0,0,null,null,1,"ion-icon",[["item-start",""],["role","img"]],[[2,"hide",null]],null,null,null,null)),c._30(1,147456,[[6,4]],0,W.a,[z.a,c.t,c.V],{name:[0,"name"]},null)],function(n,t){n(t,1,0,c._34(1,"",t.parent.context.$implicit.icon,""))},function(n,t){n(t,0,0,c._44(t,1)._hidden)})}function u(n){return c._57(0,[(n()(),c._31(0,0,null,null,20,"a",[["class","item item-block"],["ion-item",""],["text-wrap",""]],[[8,"title",0],[2,"core-split-item-selected",null]],[[null,"click"]],function(n,t,e){var l=!0;if("click"===t){l=!1!==n.component.gotoEvent(n.context.$implicit.id)&&l}return l},X.b,X.a)),c._30(1,1097728,null,3,Z.a,[nn.a,z.a,c.t,c.V,[2,tn.a]],null,null),c._52(335544320,4,{contentLabel:0}),c._52(603979776,5,{_buttons:1}),c._52(603979776,6,{_icons:1}),c._30(5,16384,null,0,en.a,[],null,null),(n()(),c._55(-1,2,["\n                    "])),(n()(),c._26(16777216,null,0,1,null,a)),c._30(8,16384,null,0,ln.k,[c._11,c._6],{ngIf:[0,"ngIf"]},null),(n()(),c._55(-1,2,["\n                    "])),(n()(),c._26(16777216,null,0,1,null,o)),c._30(11,16384,null,0,ln.k,[c._11,c._6],{ngIf:[0,"ngIf"]},null),(n()(),c._55(-1,2,["\n                    "])),(n()(),c._31(13,0,null,2,2,"h2",[],null,null,null,null,null)),(n()(),c._31(14,0,null,null,1,"core-format-text",[],null,null,null,null,null)),c._30(15,540672,null,0,an.a,[c.t,E.a,b.a,on.a,K.a,un.a,y.a,rn.a,sn.a,cn.a,D.a,dn.a,[2,_n.a],[2,fn.a]],{text:[0,"text"]},null),(n()(),c._55(-1,2,["\n                    "])),(n()(),c._31(17,0,null,2,2,"p",[],null,null,null,null,null)),(n()(),c._55(18,null,["",""])),c._49(19,1),(n()(),c._55(-1,2,["\n                "]))],function(n,t){n(t,8,0,t.context.$implicit.moduleIcon);n(t,11,0,!t.context.$implicit.moduleIcon);n(t,15,0,t.context.$implicit.name)},function(n,t){n(t,0,0,t.context.$implicit.name,t.context.$implicit.id==t.component.eventId);n(t,18,0,c._56(t,18,0,n(t,19,0,c._44(t.parent.parent,0),t.context.$implicit.timestart)))})}function r(n){return c._57(0,[(n()(),c._31(0,0,null,null,5,"ion-list",[["no-margin",""]],null,null,null,null,null)),c._30(1,16384,null,0,hn.a,[z.a,c.t,c.V,un.a,pn.l,vn.a],null,null),(n()(),c._55(-1,null,["\n                "])),(n()(),c._26(16777216,null,null,1,null,u)),c._30(4,802816,null,0,ln.j,[c._11,c._6,c.E],{ngForOf:[0,"ngForOf"]},null),(n()(),c._55(-1,null,["\n            "]))],function(n,t){n(t,4,0,t.component.filteredEvents)},null)}function s(n){return c._57(0,[c._47(0,gn.a,[sn.a]),c._52(402653184,1,{content:0}),c._52(402653184,2,{splitviewCtrl:0}),(n()(),c._31(3,0,null,null,27,"ion-header",[],null,null,null,null,null)),c._30(4,16384,null,0,mn.a,[z.a,c.t,c.V,[2,bn.a]],null,null),(n()(),c._55(-1,null,["\n    "])),(n()(),c._31(6,0,null,null,23,"ion-navbar",[["class","toolbar"]],[[8,"hidden",0],[2,"statusbar-padding",null]],null,null,yn.b,yn.a)),c._30(7,49152,null,0,En.a,[Cn.a,[2,bn.a],[2,_n.a],z.a,c.t,c.V],null,null),(n()(),c._55(-1,3,["\n        "])),(n()(),c._31(9,0,null,3,3,"ion-title",[],null,null,null,In.b,In.a)),c._30(10,49152,null,0,Ln.a,[z.a,c.t,c.V,[2,Dn.a],[2,En.a]],null,null),(n()(),c._55(11,0,["",""])),c._47(131072,J.a,[K.a,c.j]),(n()(),c._55(-1,3,["\n        "])),(n()(),c._31(14,0,null,2,14,"ion-buttons",[["end",""]],null,null,null,null,null)),c._30(15,16384,null,1,Rn.a,[z.a,c.t,c.V,[2,Dn.a],[2,En.a]],null,null),c._52(603979776,3,{_buttons:1}),(n()(),c._55(-1,null,["\n            "])),(n()(),c._26(16777216,null,null,1,null,l)),c._30(19,16384,null,0,ln.k,[c._11,c._6],{ngIf:[0,"ngIf"]},null),(n()(),c._55(-1,null,["\n            "])),(n()(),c._31(21,0,null,null,6,"core-context-menu",[],null,null,null,xn.b,xn.a)),c._30(22,245760,null,0,jn.a,[K.a,Pn.a,c.t,b.a,[2,On.a]],null,null),(n()(),c._55(-1,0,["\n                "])),(n()(),c._31(24,0,null,0,2,"core-context-menu-item",[],null,[[null,"action"]],function(n,t,e){var l=!0;if("action"===t){l=!1!==n.component.openSettings()&&l}return l},Tn.b,Tn.a)),c._30(25,770048,null,0,An.a,[jn.a],{content:[0,"content"],iconAction:[1,"iconAction"],priority:[2,"priority"],hidden:[3,"hidden"]},{action:"action"}),c._47(131072,J.a,[K.a,c.j]),(n()(),c._55(-1,0,["\n            "])),(n()(),c._55(-1,null,["\n        "])),(n()(),c._55(-1,3,["\n    "])),(n()(),c._55(-1,null,["\n"])),(n()(),c._55(-1,null,["\n"])),(n()(),c._31(32,0,null,null,31,"core-split-view",[],null,null,null,Vn.b,Vn.a)),c._30(33,114688,[[2,4]],0,R.a,[[2,_n.a],c.t],null,null),(n()(),c._55(-1,0,["\n    "])),(n()(),c._31(35,0,null,0,27,"ion-content",[],[[2,"statusbar-padding",null],[2,"has-refresher",null]],null,null,kn.b,kn.a)),c._30(36,4374528,[[1,4]],0,fn.a,[z.a,un.a,vn.a,c.t,c.V,Cn.a,wn.a,c.M,[2,bn.a],[2,_n.a]],null,null),(n()(),c._55(-1,1,["\n        "])),(n()(),c._31(38,0,null,2,6,"ion-refresher",[],[[2,"refresher-active",null],[4,"top",null]],[[null,"ionRefresh"]],function(n,t,e){var l=!0;if("ionRefresh"===t){l=!1!==n.component.refreshEvents(e)&&l}return l},null,null)),c._30(39,212992,null,0,Mn.a,[un.a,fn.a,c.M,pn.l],{enabled:[0,"enabled"]},{ionRefresh:"ionRefresh"}),(n()(),c._55(-1,null,["\n            "])),(n()(),c._31(41,0,null,null,2,"ion-refresher-content",[],[[1,"state",0]],null,null,Fn.b,Fn.a)),c._30(42,114688,null,0,$n.a,[Mn.a,z.a],{pullingText:[0,"pullingText"]},null),c._47(131072,J.a,[K.a,c.j]),(n()(),c._55(-1,null,["\n        "])),(n()(),c._55(-1,1,["\n        "])),(n()(),c._31(46,0,null,1,15,"core-loading",[],null,null,null,Nn.b,Nn.a)),c._30(47,638976,null,0,Sn.a,[K.a,c.t],{hideUntil:[0,"hideUntil"]},null),(n()(),c._55(-1,0,["\n            "])),(n()(),c._26(16777216,null,0,1,null,i)),c._30(50,16384,null,0,ln.k,[c._11,c._6],{ngIf:[0,"ngIf"]},null),(n()(),c._55(-1,0,["\n\n            "])),(n()(),c._26(16777216,null,0,1,null,r)),c._30(53,16384,null,0,ln.k,[c._11,c._6],{ngIf:[0,"ngIf"]},null),(n()(),c._55(-1,0,["\n\n            "])),(n()(),c._31(55,0,null,0,5,"ion-infinite-scroll",[],null,[[null,"ionInfinite"]],function(n,t,e){var l=!0;if("ionInfinite"===t){l=!1!==e.waitFor(n.component.fetchEvents())&&l}return l},null,null)),c._30(56,1196032,null,0,Hn.a,[fn.a,c.M,c.t,vn.a],{enabled:[0,"enabled"]},{ionInfinite:"ionInfinite"}),(n()(),c._55(-1,null,["\n               "])),(n()(),c._31(58,0,null,null,1,"ion-infinite-scroll-content",[],[[1,"state",0]],null,null,Un.b,Un.a)),c._30(59,114688,null,0,Gn.a,[Hn.a,z.a],null,null),(n()(),c._55(-1,null,["\n            "])),(n()(),c._55(-1,0,["\n        "])),(n()(),c._55(-1,1,["\n    "])),(n()(),c._55(-1,0,["\n"]))],function(n,t){var e=t.component;n(t,19,0,e.courses&&e.courses.length),n(t,22,0);n(t,25,0,c._56(t,25,0,c._44(t,26).transform("core.settings.settings")),"cog",600,!e.notificationsEnabled),n(t,33,0);n(t,39,0,e.eventsLoaded);n(t,42,0,c._34(1,"",c._56(t,42,0,c._44(t,43).transform("core.pulltorefresh")),""));n(t,47,0,e.eventsLoaded);n(t,50,0,!e.filteredEvents||!e.filteredEvents.length);n(t,53,0,e.filteredEvents&&e.filteredEvents.length);n(t,56,0,e.canLoadMore),n(t,59,0)},function(n,t){n(t,6,0,c._44(t,7)._hidden,c._44(t,7)._sbPadding);n(t,11,0,c._56(t,11,0,c._44(t,12).transform("addon.calendar.calendarevents")));n(t,35,0,c._44(t,36).statusbarPadding,c._44(t,36)._hasRefresher);n(t,38,0,"inactive"!==c._44(t,39).state,c._44(t,39)._top);n(t,41,0,c._44(t,42).r.state);n(t,58,0,c._44(t,59).inf.state)})}Object.defineProperty(t,"__esModule",{value:!0});var c=e(0),d=e(9),_=e(7),f=e(31),h=e(30),p=e(111),v=e(410),g=e(627),m=e(73),b=e(6),y=e(4),E=e(1),C=e(122),I=e(658),L=e(21),D=e(12),R=e(128),x=this&&this.__decorate||function(n,t,e,l){var i,a=arguments.length,o=a<3?t:null===l?l=Object.getOwnPropertyDescriptor(t,e):l;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(n,t,e,l);else for(var u=n.length-1;u>=0;u--)(i=n[u])&&(o=(a<3?i(o):a>3?i(t,e,o):i(t,e))||o);return a>3&&o&&Object.defineProperty(t,e,o),o},j=this&&this.__metadata||function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)},P=function(){function n(n,t,e,l,i,a,o,u,r,s,c,d,_){var f=this;this.translate=n,this.calendarProvider=t,this.domUtils=l,this.coursesProvider=i,this.utils=a,this.calendarHelper=o,this.popoverCtrl=s,this.navCtrl=d,this.daysLoaded=0,this.emptyEventsTimes=0,this.categoriesRetrieved=!1,this.getCategories=!1,this.allCourses={id:-1,fullname:this.translate.instant("core.fulllistofcourses"),category:-1},this.categories={},this.eventsLoaded=!1,this.events=[],this.notificationsEnabled=!1,this.filteredEvents=[],this.canLoadMore=!1,this.filter={course:this.allCourses},this.siteHomeId=u.getCurrentSite().getSiteHomeId(),this.notificationsEnabled=r.isAvailable(),this.notificationsEnabled&&(this.obsDefaultTimeChange=c.on(v.a.DEFAULT_NOTIFICATION_TIME_CHANGED,function(){t.scheduleEventsNotifications(f.events)},u.getCurrentSiteId())),this.eventId=e.get("eventid")||!1}return n.prototype.ionViewDidLoad=function(){var n=this;this.eventId&&this.gotoEvent(this.eventId),this.fetchData().then(function(){!n.eventId&&n.splitviewCtrl.isOn()&&n.events.length>0&&n.gotoEvent(n.events[0].id)}).finally(function(){n.eventsLoaded=!0})},n.prototype.fetchData=function(n){var t=this;return void 0===n&&(n=!1),this.daysLoaded=0,this.emptyEventsTimes=0,this.coursesProvider.getUserCourses(!1).then(function(e){return e.unshift(t.allCourses),t.courses=e,t.fetchEvents(n)})},n.prototype.fetchEvents=function(n){var t=this;return void 0===n&&(n=!1),this.calendarProvider.getEventsList(this.daysLoaded,v.a.DAYS_INTERVAL).then(function(e){if(t.daysLoaded+=v.a.DAYS_INTERVAL,0===e.length){if(t.emptyEventsTimes++,!(t.emptyEventsTimes>5))return t.fetchEvents();t.canLoadMore=!1,n&&(t.events=[],t.filteredEvents=[])}else e.sort(function(n,t){return n.timestart-t.timestart}),e.forEach(t.calendarHelper.formatEventData.bind(t.calendarHelper)),t.getCategories=t.shouldLoadCategories(e),t.events=n?e:t.utils.mergeArraysWithoutDuplicates(t.events,e,"id"),t.filteredEvents=t.getFilteredEvents(),t.canLoadMore=!0,t.calendarProvider.scheduleEventsNotifications(t.events);t.content.resize()}).catch(function(n){t.domUtils.showErrorModalDefault(n,"addon.calendar.errorloadevents",!0),t.canLoadMore=!1}).then(function(){if(t.getCategories)return t.getCategories=!1,t.loadCategories()})},n.prototype.getFilteredEvents=function(){return-1==this.filter.course.id?this.events:this.events.filter(this.shouldDisplayEvent.bind(this))},n.prototype.shouldDisplayEvent=function(n){if("user"==n.eventtype||"site"==n.eventtype)return!0;if("category"==n.eventtype){if(!n.categoryid||!Object.keys(this.categories).length)return!0;if(n.categoryid==this.filter.course.category)return!0;for(var t=this.categories[this.filter.course.category];t&&t.parent;){if(n.categoryid==t.parent)return!0;t=this.categories[t.parent]}return!1}return n.courseid===this.siteHomeId||n.courseid==this.filter.course.id},n.prototype.shouldLoadCategories=function(n){if(this.categoriesRetrieved||this.getCategories)return this.getCategories;return n.some(function(n){return"undefined"!=n.categoryid&&n.categoryid>0})||this.getCategories},n.prototype.loadCategories=function(){var n=this;return this.coursesProvider.getCategories(0,!0).then(function(t){n.categoriesRetrieved=!0,n.categories={},t.forEach(function(t){n.categories[t.id]=t})}).catch(function(){})},n.prototype.refreshEvents=function(n){var t=this,e=[];e.push(this.calendarProvider.invalidateEventsList(this.courses)),this.categoriesRetrieved&&(e.push(this.coursesProvider.invalidateCategories(0,!0)),this.categoriesRetrieved=!1),Promise.all(e).finally(function(){t.fetchData(!0).finally(function(){n.complete()})})},n.prototype.openCourseFilter=function(n){var t=this,e=this.popoverCtrl.create(I.a,{courses:this.courses,courseId:this.filter.course.id});e.onDidDismiss(function(n){n&&(t.filter.course=n,t.content.scrollToTop(),t.filteredEvents=t.getFilteredEvents())}),e.present({ev:n})},n.prototype.openSettings=function(){this.navCtrl.push("AddonCalendarSettingsPage")},n.prototype.gotoEvent=function(n){this.eventId=n,this.splitviewCtrl.push("AddonCalendarEventPage",{id:n})},n.prototype.ngOnDestroy=function(){this.obsDefaultTimeChange&&this.obsDefaultTimeChange.off()},x([Object(c._9)(d.f),j("design:type",d.f)],n.prototype,"content",void 0),x([Object(c._9)(R.a),j("design:type",R.a)],n.prototype,"splitviewCtrl",void 0),n=x([Object(c.m)({selector:"page-addon-calendar-list",templateUrl:"list.html"}),j("design:paramtypes",[_.c,v.a,d.r,b.a,m.a,y.a,g.a,E.a,C.a,d.t,L.a,d.q,D.a])],n)}(),O=this&&this.__decorate||function(n,t,e,l){var i,a=arguments.length,o=a<3?t:null===l?l=Object.getOwnPropertyDescriptor(t,e):l;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(n,t,e,l);else for(var u=n.length-1;u>=0;u--)(i=n[u])&&(o=(a<3?i(o):a>3?i(t,e,o):i(t,e))||o);return a>3&&o&&Object.defineProperty(t,e,o),o},T=function(){function n(){}return n=O([Object(c.I)({declarations:[P],imports:[f.a,h.a,p.a,d.l.forChild(P),_.b.forChild()]})],n)}(),A=e(1243),V=e(1244),k=e(1245),w=e(1246),M=e(1247),F=e(1248),$=e(1249),N=e(1250),S=e(1251),H=e(1254),U=e(1255),G=e(1256),Y=e(43),q=e(37),z=e(3),J=e(28),K=e(15),W=e(38),B=e(151),Q=e(129),X=e(33),Z=e(19),nn=e(18),tn=e(29),en=e(32),ln=e(8),an=e(39),on=e(10),un=e(13),rn=e(23),sn=e(2),cn=e(16),dn=e(22),_n=e(20),fn=e(24),hn=e(75),pn=e(35),vn=e(25),gn=e(1263),mn=e(402),bn=e(34),yn=e(1252),En=e(182),Cn=e(27),In=e(1253),Ln=e(315),Dn=e(227),Rn=e(403),xn=e(77),jn=e(67),Pn=e(65),On=e(66),Tn=e(78),An=e(71),Vn=e(405),kn=e(183),wn=e(93),Mn=e(139),Fn=e(203),$n=e(150),Nn=e(57),Sn=e(55),Hn=e(212),Un=e(413),Gn=e(235),Yn=e(54),qn=c._29({encapsulation:2,styles:[],data:{}}),zn=c._27("page-addon-calendar-list",P,function(n){return c._57(0,[(n()(),c._31(0,0,null,null,1,"page-addon-calendar-list",[],null,null,null,s,qn)),c._30(1,180224,null,0,P,[K.a,v.a,Yn.a,b.a,m.a,y.a,g.a,E.a,C.a,Pn.a,L.a,_n.a,D.a],null,null)],null,null)},{},{},[]),Jn=e(17),Kn=e(311),Wn=e(312),Bn=e(314),Qn=e(313),Xn=e(401),Zn=e(615),nt=e(228);e.d(t,"AddonCalendarListPageModuleNgFactory",function(){return tt});var tt=c._28(T,[],function(n){return c._40([c._41(512,c.o,c._21,[[8,[A.a,V.a,k.a,w.a,M.a,F.a,$.a,N.a,S.a,H.a,U.a,G.a,zn]],[3,c.o],c.K]),c._41(4608,ln.m,ln.l,[c.G,[2,ln.v]]),c._41(4608,Jn.x,Jn.x,[]),c._41(4608,Jn.d,Jn.d,[]),c._41(4608,Kn.b,Kn.a,[]),c._41(4608,Wn.a,Wn.b,[]),c._41(4608,Bn.b,Bn.a,[]),c._41(4608,Qn.b,Qn.a,[]),c._41(4608,K.a,K.a,[Xn.a,Kn.b,Wn.a,Bn.b,Qn.b,K.b,K.c]),c._41(512,ln.b,ln.b,[]),c._41(512,Jn.v,Jn.v,[]),c._41(512,Jn.i,Jn.i,[]),c._41(512,Jn.s,Jn.s,[]),c._41(512,Zn.a,Zn.a,[]),c._41(512,_.b,_.b,[]),c._41(512,h.a,h.a,[]),c._41(512,p.a,p.a,[]),c._41(512,f.a,f.a,[]),c._41(512,Zn.b,Zn.b,[]),c._41(512,T,T,[]),c._41(256,K.c,void 0,[]),c._41(256,K.b,void 0,[]),c._41(256,nt.a,P,[])])})}});