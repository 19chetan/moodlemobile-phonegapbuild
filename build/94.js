webpackJsonp([94],{1755:function(n,l,t){"use strict";function e(n){return u._57(0,[(n()(),u._31(0,0,null,null,3,"ion-label",[["id","addon-data-groupslabel"]],null,null,null,null,null)),u._30(1,16384,[[3,4]],0,Y.a,[z.a,u.t,u.V,[8,null],[8,null],[8,null],[8,null]],{id:[0,"id"]},null),(n()(),u._55(2,null,["",""])),u._47(131072,Q.a,[W.a,u.j])],function(n,l){n(l,1,0,"addon-data-groupslabel")},function(n,l){n(l,2,0,u._56(l,2,0,u._44(l,3).transform("core.groupsseparate")))})}function a(n){return u._57(0,[(n()(),u._31(0,0,null,null,3,"ion-label",[["id","addon-data-groupslabel"]],null,null,null,null,null)),u._30(1,16384,[[3,4]],0,Y.a,[z.a,u.t,u.V,[8,null],[8,null],[8,null],[8,null]],{id:[0,"id"]},null),(n()(),u._55(2,null,["",""])),u._47(131072,Q.a,[W.a,u.j])],function(n,l){n(l,1,0,"addon-data-groupslabel")},function(n,l){n(l,2,0,u._56(l,2,0,u._44(l,3).transform("core.groupsvisible")))})}function i(n){return u._57(0,[(n()(),u._31(0,0,null,null,2,"ion-option",[],null,null,null,null,null)),u._30(1,16384,[[6,4]],0,X.a,[u.t],{value:[0,"value"]},null),(n()(),u._55(2,null,["",""]))],function(n,l){n(l,1,0,l.context.$implicit.id)},function(n,l){n(l,2,0,l.context.$implicit.name)})}function r(n){return u._57(0,[(n()(),u._31(0,0,null,null,24,"ion-item",[["class","item item-block"],["text-wrap",""]],null,null,null,Z.b,Z.a)),u._30(1,1097728,null,3,nn.a,[ln.a,z.a,u.t,u.V,[2,tn.a]],null,null),u._52(603979776,3,{contentLabel:0}),u._52(603979776,4,{_buttons:1}),u._52(603979776,5,{_icons:1}),u._30(5,16384,null,0,en.a,[],null,null),(n()(),u._55(-1,2,["\n            "])),(n()(),u._26(16777216,null,1,1,null,e)),u._30(8,16384,null,0,an.k,[u._11,u._6],{ngIf:[0,"ngIf"]},null),(n()(),u._55(-1,2,["\n            "])),(n()(),u._26(16777216,null,1,1,null,a)),u._30(11,16384,null,0,an.k,[u._11,u._6],{ngIf:[0,"ngIf"]},null),(n()(),u._55(-1,2,["\n            "])),(n()(),u._31(13,0,null,3,10,"ion-select",[["aria-labelledby","addon-data-groupslabel"]],[[2,"select-disabled",null],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"ionChange"],[null,"click"],[null,"keyup.space"]],function(n,l,t){var e=!0,a=n.component;if("click"===l){e=!1!==u._44(n,14)._click(t)&&e}if("keyup.space"===l){e=!1!==u._44(n,14)._keyup()&&e}if("ngModelChange"===l){e=!1!==(a.selectedGroup=t)&&e}if("ionChange"===l){e=!1!==a.setGroup(a.selectedGroup)&&e}return e},rn.b,rn.a)),u._30(14,1228800,null,1,on.a,[un.a,ln.a,z.a,u.t,u.V,[2,nn.a],dn.a],null,{ionChange:"ionChange"}),u._52(603979776,6,{options:1}),u._50(1024,null,g.l,function(n){return[n]},[on.a]),u._30(17,671744,null,0,g.q,[[8,null],[8,null],[8,null],[2,g.l]],{model:[0,"model"]},{update:"ngModelChange"}),u._50(2048,null,g.m,null,[g.q]),u._30(19,16384,null,0,g.n,[g.m],null,null),(n()(),u._55(-1,null,["\n                "])),(n()(),u._26(16777216,null,null,1,null,i)),u._30(22,802816,null,0,an.j,[u._11,u._6,u.E],{ngForOf:[0,"ngForOf"]},null),(n()(),u._55(-1,null,["\n            "])),(n()(),u._55(-1,2,["\n        "]))],function(n,l){var t=l.component;n(l,8,0,t.groupInfo.separateGroups);n(l,11,0,t.groupInfo.visibleGroups);n(l,17,0,t.selectedGroup);n(l,22,0,t.groupInfo.groups)},function(n,l){n(l,13,0,u._44(l,14)._disabled,u._44(l,19).ngClassUntouched,u._44(l,19).ngClassTouched,u._44(l,19).ngClassPristine,u._44(l,19).ngClassDirty,u._44(l,19).ngClassValid,u._44(l,19).ngClassInvalid,u._44(l,19).ngClassPending)})}function o(n){return u._57(0,[u._52(402653184,1,{content:0}),(n()(),u._31(1,0,null,null,24,"ion-header",[],null,null,null,null,null)),u._30(2,16384,null,0,sn.a,[z.a,u.t,u.V,[2,cn.a]],null,null),(n()(),u._55(-1,null,["\n    "])),(n()(),u._31(4,0,null,null,20,"ion-navbar",[["class","toolbar"]],[[8,"hidden",0],[2,"statusbar-padding",null]],null,null,fn.b,fn.a)),u._30(5,49152,null,0,_n.a,[un.a,[2,cn.a],[2,pn.a],z.a,u.t,u.V],null,null),(n()(),u._55(-1,3,["\n        "])),(n()(),u._31(7,0,null,3,3,"ion-title",[],null,null,null,hn.b,hn.a)),u._30(8,49152,null,0,gn.a,[z.a,u.t,u.V,[2,mn.a],[2,_n.a]],null,null),(n()(),u._31(9,0,null,0,1,"core-format-text",[],null,null,null,null,null)),u._30(10,540672,null,0,yn.a,[u.t,v.a,y.a,vn.a,W.a,bn.a,m.a,In.a,Cn.a,Pn.a,En.a,jn.a,[2,pn.a],[2,Dn.a]],{text:[0,"text"]},null),(n()(),u._55(-1,3,["\n        "])),(n()(),u._31(12,0,null,2,11,"ion-buttons",[["end",""]],null,null,null,null,null)),u._30(13,16384,null,1,Fn.a,[z.a,u.t,u.V,[2,mn.a],[2,_n.a]],null,null),u._52(603979776,2,{_buttons:1}),(n()(),u._55(-1,null,["\n            "])),(n()(),u._31(16,0,null,null,6,"button",[["icon-only",""],["ion-button",""]],[[1,"aria-label",0]],[[null,"click"]],function(n,l,t){var e=!0;if("click"===l){e=!1!==n.component.save()&&e}return e},Tn.b,Tn.a)),u._30(17,1097728,[[2,4]],0,An.a,[[8,""],z.a,u.t,u.V],null,null),u._47(131072,Q.a,[W.a,u.j]),(n()(),u._55(-1,0,["\n                "])),(n()(),u._31(20,0,null,0,1,"ion-icon",[["name","send"],["role","img"]],[[2,"hide",null]],null,null,null,null)),u._30(21,147456,null,0,On.a,[z.a,u.t,u.V],{name:[0,"name"]},null),(n()(),u._55(-1,0,["\n            "])),(n()(),u._55(-1,null,["\n        "])),(n()(),u._55(-1,3,["\n    "])),(n()(),u._55(-1,null,["\n"])),(n()(),u._55(-1,null,["\n"])),(n()(),u._31(27,0,null,null,23,"ion-content",[],[[2,"statusbar-padding",null],[2,"has-refresher",null]],null,null,Gn.b,Gn.a)),u._30(28,4374528,[[1,4]],0,Dn.a,[z.a,bn.a,wn.a,u.t,u.V,un.a,xn.a,u.M,[2,cn.a],[2,pn.a]],null,null),(n()(),u._55(-1,1,["\n    "])),(n()(),u._31(30,0,null,1,19,"core-loading",[],null,null,null,Rn.b,Rn.a)),u._30(31,638976,null,0,Vn.a,[W.a,u.t],{hideUntil:[0,"hideUntil"]},null),(n()(),u._55(-1,0,["\n        "])),(n()(),u._26(16777216,null,0,1,null,r)),u._30(34,16384,null,0,an.k,[u._11,u._6],{ngIf:[0,"ngIf"]},null),(n()(),u._55(-1,0,["\n\n        "])),(n()(),u._31(36,0,null,0,12,"div",[],[[8,"className",0]],null,null,null,null)),(n()(),u._55(-1,null,["\n            "])),(n()(),u._55(-1,null,["\n\n            "])),(n()(),u._31(39,0,null,null,8,"form",[["novalidate",""]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngSubmit"],[null,"submit"],[null,"reset"]],function(n,l,t){var e=!0,a=n.component;if("submit"===l){e=!1!==u._44(n,41).onSubmit(t)&&e}if("reset"===l){e=!1!==u._44(n,41).onReset()&&e}if("ngSubmit"===l){e=!1!==a.save()&&e}return e},null,null)),u._30(40,16384,null,0,g.w,[],null,null),u._30(41,540672,null,0,g.h,[[8,null],[8,null]],{form:[0,"form"]},{ngSubmit:"ngSubmit"}),u._50(2048,null,g.b,null,[g.h]),u._30(43,16384,null,0,g.o,[g.b],null,null),(n()(),u._55(-1,null,["\n                "])),(n()(),u._31(45,0,null,null,1,"core-compile-html",[],null,null,null,Un.b,Un.a)),u._30(46,966656,null,0,kn.a,[Hn.a,u.j,u.t,[2,pn.a],u.F,y.a],{text:[0,"text"],jsData:[1,"jsData"],extraImports:[2,"extraImports"]},null),(n()(),u._55(-1,null,["\n            "])),(n()(),u._55(-1,null,["\n        "])),(n()(),u._55(-1,0,["\n    "])),(n()(),u._55(-1,1,["\n"])),(n()(),u._55(-1,null,["\n"]))],function(n,l){var t=l.component;n(l,10,0,t.title);n(l,21,0,"send");n(l,31,0,t.loaded);n(l,34,0,t.groupInfo&&(t.groupInfo.separateGroups||t.groupInfo.visibleGroups));n(l,41,0,t.editForm);n(l,46,0,t.editFormRender,t.jsData,t.extraImports)},function(n,l){var t=l.component;n(l,4,0,u._44(l,5)._hidden,u._44(l,5)._sbPadding);n(l,16,0,u._56(l,16,0,u._44(l,18).transform("core.save")));n(l,20,0,u._44(l,21)._hidden);n(l,27,0,u._44(l,28).statusbarPadding,u._44(l,28)._hasRefresher);n(l,36,0,u._34(1,"addon-data-contents ",t.cssClass,""));n(l,39,0,u._44(l,43).ngClassUntouched,u._44(l,43).ngClassTouched,u._44(l,43).ngClassPristine,u._44(l,43).ngClassDirty,u._44(l,43).ngClassValid,u._44(l,43).ngClassInvalid,u._44(l,43).ngClassPending)})}Object.defineProperty(l,"__esModule",{value:!0});var u=t(0),d=t(9),s=t(7),c=t(30),f=t(31),_=t(407),p=t(406),h=t(404),g=t(17),m=t(4),y=t(6),v=t(1),b=t(64),I=t(21),C=t(74),P=t(14),E=t(86),j=t(234),D=t(191),F=t(95),T=this&&this.__decorate||function(n,l,t,e){var a,i=arguments.length,r=i<3?l:null===e?e=Object.getOwnPropertyDescriptor(l,t):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,l,t,e);else for(var o=n.length-1;o>=0;o--)(a=n[o])&&(r=(i<3?a(r):i>3?a(l,t,r):a(l,t))||r);return i>3&&r&&Object.defineProperty(l,t,r),r},A=this&&this.__metadata||function(n,l){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,l)},O=function(){function n(n,l,t,e,a,i,r,o,u,d,s,c,f,_){this.utils=l,this.groupsProvider=t,this.domUtils=e,this.fieldsDelegate=a,this.courseProvider=i,this.dataProvider=r,this.dataOffline=o,this.dataHelper=u,this.navCtrl=s,this.translate=c,this.eventsProvider=f,this.fileUploaderProvider=_,this.offlineActions=[],this.fields={},this.fieldsArray=[],this.forceLeave=!1,this.title="",this.component=E.a.COMPONENT,this.loaded=!1,this.selectedGroup=0,this.cssClass="",this.cssTemplate="",this.editFormRender="",this.extraImports=[h.a],this.errors={},this.module=n.get("module")||{},this.entryId=n.get("entryId")||null,this.courseId=n.get("courseId"),this.selectedGroup=n.get("group")||0,this.siteId=d.getCurrentSiteId(),this.title=this.module.name,this.editForm=new g.g({})}return n.prototype.ionViewDidLoad=function(){this.fetchEntryData()},n.prototype.ionViewCanLeave=function(){var n=this;if(this.forceLeave)return!0;var l=this.editForm.value;return this.dataHelper.hasEditDataChanged(l,this.fieldsArray,this.data.id,this.entry.contents).then(function(l){return l?n.domUtils.showConfirm(n.translate.instant("core.confirmcanceledit")):Promise.resolve()}).then(function(){return n.dataHelper.getEditTmpFiles(l,n.fieldsArray,n.data.id,n.entry.contents).then(function(l){n.fileUploaderProvider.clearTmpFiles(l)})})},n.prototype.fetchEntryData=function(){var n=this;return this.dataProvider.getDatabase(this.courseId,this.module.id).then(function(l){return n.title=l.name||n.title,n.data=l,n.cssClass="addon-data-entries-"+l.id,n.dataProvider.getDatabaseAccessInformation(l.id)}).then(function(l){if(n.cssTemplate=n.dataHelper.prefixCSS(n.data.csstemplate,"."+n.cssClass),n.entryId)return n.groupsProvider.getActivityGroupInfo(n.data.coursemodule,l.canmanageentries).then(function(l){n.groupInfo=l,l&&l.groups&&l.groups.length>0&&(l.groups.some(function(l){return n.selectedGroup==l.id})||(n.selectedGroup=l.groups[0].id))})}).then(function(){return n.dataOffline.getEntryActions(n.data.id,n.entryId)}).then(function(l){return n.offlineActions=l,n.dataProvider.getFields(n.data.id)}).then(function(l){return n.fieldsArray=l,n.fields=n.utils.arrayToObject(l,"id"),n.dataHelper.getEntry(n.data,n.entryId,n.offlineActions)}).then(function(l){return l?(l=l.entry).contents=n.utils.arrayToObject(l.contents,"fieldid"):l={contents:{}},n.dataHelper.applyOfflineActions(l,n.offlineActions,n.fieldsArray)}).then(function(l){n.entry=l,n.editFormRender=n.displayEditFields()}).catch(function(l){n.domUtils.showErrorModalDefault(l,"core.course.errorgetmodule",!0)}).finally(function(){n.loaded=!0})},n.prototype.save=function(){var n=this,l=this.editForm.value;return this.dataHelper.hasEditDataChanged(l,this.fieldsArray,this.data.id,this.entry.contents).then(function(t){if(!t)return n.entryId?n.returnToEntryList():Promise.reject("addon.mod_data.emptyaddform");var e=n.domUtils.showModalLoading("core.sending",!0),a=n.entryId?n.entryId:-(new Date).getTime();return n.dataHelper.getEditDataFromForm(l,n.fieldsArray,n.data.id,a,n.entry.contents,n.offline).catch(function(t){return n.offline?Promise.reject(t):(n.offline=!0,n.dataHelper.getEditDataFromForm(l,n.fieldsArray,n.data.id,a,n.entry.contents,n.offline))}).then(function(l){return l.length>0&&(n.entryId?n.dataProvider.editEntry(n.data.id,n.entryId,n.courseId,l,n.fields,void 0,n.offline):n.dataProvider.addEntry(n.data.id,a,n.courseId,l,n.selectedGroup,n.fields,void 0,n.offline))}).then(function(l){if(!l)return Promise.reject("addon.mod_data.emptyaddform");if(n.entryId&&l.updated||!n.entryId&&l.newentryid){var t=[];return n.entryId=n.entryId||l.newentryid,t.push(n.dataProvider.invalidateEntryData(n.data.id,n.entryId,n.siteId)),t.push(n.dataProvider.invalidateEntriesData(n.data.id,n.siteId)),Promise.all(t).then(function(){n.eventsProvider.trigger(E.a.ENTRY_CHANGED,{dataId:n.data.id,entryId:n.entryId},n.siteId)}).finally(function(){return n.returnToEntryList()})}n.errors={},l.fieldnotifications.forEach(function(l){var t=n.fieldsArray.find(function(n){return n.name==l.fieldname});t&&(n.errors[t.id]=l.notification)}),n.jsData.errors=n.errors,setTimeout(function(){n.scrollToFirstError()})}).finally(function(){e.dismiss()})}).catch(function(l){return n.domUtils.showErrorModalDefault(l,"Cannot edit entry",!0),Promise.reject(null)})},n.prototype.setGroup=function(n){return this.selectedGroup=n,this.loaded=!1,this.fetchEntryData()},n.prototype.displayEditFields=function(){if(!this.data.addtemplate)return"";this.jsData={fields:this.fields,contents:this.entry.contents,form:this.editForm,data:this.data,errors:this.errors};var n,l=this.data.addtemplate;return this.fieldsArray.forEach(function(t){n=(n="[["+t.name+"]]").replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),n=new RegExp(n,"gi"),l=l.replace(n,'<addon-mod-data-field-plugin mode="edit" [field]="fields['+t.id+']"                [value]="contents['+t.id+']" [form]="form" [database]="data" [error]="errors['+t.id+']">                </addon-mod-data-field-plugin>'),n=(n="[["+t.name+"#id]]").replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),n=new RegExp(n,"gi"),l=l.replace(n,"field_"+t.id)}),l},n.prototype.returnToEntryList=function(){var n=this;return this.dataHelper.getEditTmpFiles(this.editForm.value,this.fieldsArray,this.data.id,this.entry.contents).then(function(l){n.fileUploaderProvider.clearTmpFiles(l)}).finally(function(){n.forceLeave=!0,n.navCtrl.pop()})},n.prototype.scrollToFirstError=function(){this.domUtils.scrollToElementBySelector(this.content,".addon-data-error")||this.content.scrollToTop()},T([Object(u._9)(d.f),A("design:type",d.f)],n.prototype,"content",void 0),n=T([Object(u.m)({selector:"page-addon-mod-data-edit",templateUrl:"edit.html"}),A("design:paramtypes",[d.r,m.a,b.a,y.a,F.a,P.a,E.a,D.a,j.a,v.a,d.q,s.c,I.a,C.a])],n)}(),G=this&&this.__decorate||function(n,l,t,e){var a,i=arguments.length,r=i<3?l:null===e?e=Object.getOwnPropertyDescriptor(l,t):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,l,t,e);else for(var o=n.length-1;o>=0;o--)(a=n[o])&&(r=(i<3?a(r):i>3?a(l,t,r):a(l,t))||r);return i>3&&r&&Object.defineProperty(l,t,r),r},w=function(){function n(){}return n=G([Object(u.I)({declarations:[O],imports:[c.a,f.a,h.a,p.a,_.a,d.l.forChild(O),s.b.forChild()]})],n)}(),x=t(1243),R=t(1244),V=t(1245),U=t(1246),k=t(1247),H=t(1248),M=t(1249),L=t(1250),S=t(1251),N=t(1254),$=t(1255),q=t(1256),B=t(1257),J=t(622),K=t(1267),Y=t(61),z=t(3),Q=t(28),W=t(15),X=t(102),Z=t(33),nn=t(19),ln=t(18),tn=t(29),en=t(32),an=t(8),rn=t(118),on=t(103),un=t(27),dn=t(48),sn=t(402),cn=t(34),fn=t(1252),_n=t(182),pn=t(20),hn=t(1253),gn=t(315),mn=t(227),yn=t(39),vn=t(10),bn=t(13),In=t(23),Cn=t(2),Pn=t(16),En=t(12),jn=t(22),Dn=t(24),Fn=t(403),Tn=t(43),An=t(37),On=t(38),Gn=t(183),wn=t(25),xn=t(93),Rn=t(57),Vn=t(55),Un=t(193),kn=t(158),Hn=t(125),Mn=t(54),Ln=u._29({encapsulation:0,styles:["{{ cssTemplate }}"],data:{}}),Sn=u._27("page-addon-mod-data-edit",O,function(n){return u._57(0,[(n()(),u._31(0,0,null,null,1,"page-addon-mod-data-edit",[],null,null,null,o,Ln)),u._30(1,49152,null,0,O,[Mn.a,m.a,b.a,y.a,F.a,P.a,E.a,D.a,j.a,v.a,pn.a,W.a,I.a,C.a],null,null)],null,null)},{},{},[]),Nn=t(311),$n=t(312),qn=t(314),Bn=t(313),Jn=t(401),Kn=t(615),Yn=t(111),zn=t(70),Qn=t(228);t.d(l,"AddonModDataEditPageModuleNgFactory",function(){return Wn});var Wn=u._28(w,[],function(n){return u._40([u._41(512,u.o,u._21,[[8,[x.a,R.a,V.a,U.a,k.a,H.a,M.a,L.a,S.a,N.a,$.a,q.a,B.a,J.a,K.a,Sn]],[3,u.o],u.K]),u._41(4608,an.m,an.l,[u.G,[2,an.v]]),u._41(4608,g.x,g.x,[]),u._41(4608,g.d,g.d,[]),u._41(4608,Nn.b,Nn.a,[]),u._41(4608,$n.a,$n.b,[]),u._41(4608,qn.b,qn.a,[]),u._41(4608,Bn.b,Bn.a,[]),u._41(4608,W.a,W.a,[Jn.a,Nn.b,$n.a,qn.b,Bn.b,W.b,W.c]),u._41(512,c.a,c.a,[]),u._41(512,an.b,an.b,[]),u._41(512,g.v,g.v,[]),u._41(512,g.i,g.i,[]),u._41(512,g.s,g.s,[]),u._41(512,Kn.a,Kn.a,[]),u._41(512,s.b,s.b,[]),u._41(512,Yn.a,Yn.a,[]),u._41(512,f.a,f.a,[]),u._41(512,zn.a,zn.a,[]),u._41(512,p.a,p.a,[]),u._41(512,_.a,_.a,[]),u._41(512,h.a,h.a,[]),u._41(512,Kn.b,Kn.b,[]),u._41(512,w,w,[]),u._41(256,W.c,void 0,[]),u._41(256,W.b,void 0,[]),u._41(256,Qn.a,O,[])])})}});